<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Accounting Interview Simulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
 margin:0;
 font-family:Tahoma;
 background:#000;
 color:#fff;
 overflow:hidden;
}
#three { height:38vh; }
.desk { height:50px; background:#5d4037; }
.panel { padding:15px; background:#111; height:62vh; overflow:auto; }
.question { font-size:20px; border-right:4px solid #00e5ff; padding-right:10px; }
textarea {
 width:100%; height:80px; margin-top:10px;
 border-radius:8px; border:none; padding:10px;
}
.buttons button {
 width:100%; margin-top:8px;
 padding:12px; font-size:15px;
 border:none; border-radius:8px;
}
.read{background:#0288d1;color:#fff}
.voice{background:#2e7d32;color:#fff}
.next{background:#6a1b9a;color:#fff}
.record{background:#c62828;color:#fff}
#timer {
 position:absolute; top:10px; left:10px;
 background:red; padding:8px 15px;
 font-size:18px; border-radius:20px;
}
@keyframes shake {
 0%{transform:translateX(0)}
 25%{transform:translateX(5px)}
 50%{transform:translateX(-5px)}
 75%{transform:translateX(5px)}
 100%{transform:translateX(0)}
}
</style>
</head>

<body>

<div id="timer">30</div>
<div id="three"></div>
<div class="desk"></div>

<div class="panel">
 <div class="question" id="q"></div>
 <textarea id="a" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØµÙˆØª..."></textarea>

 <div class="buttons">
  <button class="read" onclick="playQ()">ğŸ”Š Ø§Ù„Ø³Ø¤Ø§Ù„</button>
  <button class="voice" onclick="voiceIn()">ğŸ¤ Ø¥Ø¬Ø§Ø¨Ø© ØµÙˆØªÙŠØ©</button>
  <button class="record" onclick="startRec()">ğŸ¥ ØªØ³Ø¬ÙŠÙ„</button>
  <button class="next" onclick="next()">â¡ï¸ Ø§Ù„ØªØ§Ù„ÙŠ</button>
 </div>
</div>

<audio id="audio"></audio>
<audio id="heart" src="audio/heartbeat.mp3" loop></audio>

<script>
/* ===== Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ===== */
const qs=[
{t:"Ø¹Ø±Ù Ù†ÙØ³Ùƒ ÙÙŠ Ø¯Ù‚ÙŠÙ‚Ø©.",c:"psy"},
{t:"ÙƒÙŠÙ ØªØªØµØ±Ù ØªØ­Øª Ø§Ù„Ø¶ØºØ·ØŸ",c:"psy"},
{t:"Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ø±Ø£Ø³Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¥ÙŠØ±Ø§Ø¯ÙŠØŸ",c:"acc"},
{t:"ÙƒÙŠÙ ØªØ¹Ø§Ù„Ø¬ Ø¹Ø¯Ù… ØªÙˆØ§Ø²Ù† Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŸ",c:"acc"},
{t:"Ù…ØªÙ‰ ÙŠØªÙ… Ø§Ù„Ø§Ø¹ØªØ±Ø§Ù Ø¨Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ØŸ",c:"acc"},
{t:"Ù…Ø§ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¥Ù‡Ù„Ø§ÙƒØŸ",c:"acc"},
{t:"Ø¥Ø°Ø§ Ø²Ø§Ø¯Øª Ø§Ù„Ø®ØµÙˆÙ… Ø¹Ù† Ø§Ù„Ø£ØµÙˆÙ„ØŸ",c:"iq"},
{t:"ÙƒÙŠÙ ØªØªØ®Ø° Ù‚Ø±Ø§Ø±Ù‹Ø§ Ù…Ø¹ Ù†Ù‚Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ",c:"iq"},
{t:"Ù‡Ù„ ØªÙØ¶Ù„ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙØ±Ø¯ÙŠ Ø£Ù… Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØŸ",c:"psy"}
];

const keys={
 acc:["Ø£ØµÙˆÙ„","Ø®ØµÙˆÙ…","Ø¥ÙŠØ±Ø§Ø¯","Ù…ØµØ±ÙˆÙ","Ø¥Ù‡Ù„Ø§Ùƒ"],
 psy:["Ø£ØªØ¹Ø§Ù…Ù„","Ø£Ø·ÙˆØ±","Ø£ØªØ¹Ù„Ù…","Ø£ØªØ­Ù…Ù„"],
 iq:["ØªØ­Ù„ÙŠÙ„","Ù‚Ø±Ø§Ø±","Ø¨Ø¯Ø§Ø¦Ù„"]
};

let i=0,score={acc:0,psy:0,iq:0};
const q=document.getElementById("q");
const a=document.getElementById("a");
const audio=document.getElementById("audio");

/* ===== Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ ===== */
function show(){
 q.innerText=qs[i].t;
 audio.src="audio/q"+(i+1)+".mp3";
 audio.play();
 startTimer();
}
show();

/* ===== ØªØ§ÙŠÙ…Ø± Ø¶ØºØ· Ù†ÙØ³ÙŠ ===== */
let tInt;
function startTimer(){
 let t=30;
 clearInterval(tInt);
 document.getElementById("heart").pause();
 tInt=setInterval(()=>{
  document.getElementById("timer").innerText=t;
  if(t<10){
   document.body.style.animation="shake .2s infinite";
   document.getElementById("heart").play();
  }
  if(t--<0){clearInterval(tInt);next();}
 },1000);
}

/* ===== ØªÙ‚ÙŠÙŠÙ… ===== */
function evalAns(){
 let txt=a.value;
 let pts=txt.split(" ").length>5?2:0;
 keys[qs[i].c].forEach(k=>{if(txt.includes(k))pts++;});
 score[qs[i].c]+=pts;
}

/* ===== Ø§Ù„ØªØ§Ù„ÙŠ ===== */
function next(){
 evalAns();
 document.body.style.animation="";
 i++;
 a.value="";
 if(i>=qs.length){finish();return;}
 show();
}

/* ===== Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ===== */
function finish(){
 q.innerHTML=`Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¥Ù†ØªØ±ÙÙŠÙˆ âœ…<br>
 Ù†ÙØ³ÙŠ: ${score.psy}<br>
 Ù…Ø­Ø§Ø³Ø¨Ø©: ${score.acc}<br>
 Ø°ÙƒØ§Ø¡: ${score.iq}<br>
 Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${level()}`;
 genPDF();
}

/* ===== Ù…Ø³ØªÙˆÙ‰ ===== */
function level(){
 let s=score.acc+score.psy+score.iq;
 if(s>30)return"Ù…Ù…ØªØ§Ø² Ø¬Ø¯Ù‹Ø§";
 if(s>20)return"Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§";
 if(s>10)return"Ø¬ÙŠØ¯";
 return"ÙŠØ­ØªØ§Ø¬ ØªØ·ÙˆÙŠØ±";
}

/* ===== PDF ===== */
function genPDF(){
 const {jsPDF}=window.jspdf;
 const d=new jsPDF();
 d.text("Accounting Interview Certificate",20,20);
 d.text("Psychological: "+score.psy,20,40);
 d.text("Accounting: "+score.acc,20,50);
 d.text("IQ: "+score.iq,20,60);
 d.text("Final: "+level(),20,80);
 d.save("Interview-Certificate.pdf");
}

/* ===== ØµÙˆØª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ===== */
function voiceIn(){
 if(!webkitSpeechRecognition)return alert("Chrome ÙÙ‚Ø·");
 let r=new webkitSpeechRecognition();
 r.lang="ar-EG"; r.start();
 r.onresult=e=>a.value+=e.results[0][0].transcript;
}

/* ===== ØªØ³Ø¬ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ ===== */
let rec,chunks=[];
async function startRec(){
 const s=await navigator.mediaDevices.getDisplayMedia({video:true,audio:true});
 rec=new MediaRecorder(s);
 rec.ondataavailable=e=>chunks.push(e.data);
 rec.onstop=()=>{
  let b=new Blob(chunks,{type:"video/webm"});
  let u=URL.createObjectURL(b);
  let a=document.createElement("a");
  a.href=u;a.download="interview.webm";a.click();
 };
 rec.start();
 alert("ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„");
}

/* ===== Three.js ===== */
let scene=new THREE.Scene();
let cam=new THREE.PerspectiveCamera(45,window.innerWidth/(window.innerHeight*.38),.1,100);
cam.position.set(0,1.6,2.8);
let ren=new THREE.WebGLRenderer({antialias:true});
ren.setSize(window.innerWidth,window.innerHeight*.38);
document.getElementById("three").appendChild(ren.domElement);
scene.add(new THREE.AmbientLight(0xffffff,.7));
let dl=new THREE.DirectionalLight(0xffffff,1);
dl.position.set(2,5,5);scene.add(dl);
let model;
new THREE.GLTFLoader().load("accountant.glb",g=>{
 model=g.scene;model.scale.set(1.4,1.4,1.4);
 model.position.y=-1;scene.add(model);
 animate();
});
function animate(){
 requestAnimationFrame(animate);
 if(model)model.rotation.y+=.001;
 ren.render(scene,cam);
}
</script>
</body>
</html>
