<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Accounting Interview 3D</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/loaders/GLTFLoader.js"></script>

<style>
body {
    margin: 0;
    font-family: Tahoma, Arial;
    background: radial-gradient(#111, #000);
    color: #fff;
}
.container { max-width: 1000px; margin: auto; }
#threeScene { height: 380px; background: #111; }
.desk { height: 60px; background: linear-gradient(#6d4c41, #4e342e); }
.content { padding: 20px; background: #0d0d0d; }
.question {
    font-size: 20px;
    min-height: 70px;
    border-right: 4px solid #00e5ff;
    padding-right: 10px;
    margin-bottom: 10px;
}
textarea {
    width: 100%;
    height: 90px;
    font-size: 16px;
    padding: 10px;
    border-radius: 8px;
    border: none;
}
.buttons { display: flex; gap: 10px; margin-top: 10px; }
button {
    flex: 1;
    padding: 12px;
    font-size: 15px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
}
.read { background: #0288d1; color: #fff; }
.voice { background: #2e7d32; color: #fff; }
.next { background: #6a1b9a; color: #fff; }
</style>
</head>

<body>

<div class="container">
    <div id="threeScene"></div>
    <div class="desk"></div>

    <div class="content">
        <div class="question" id="question"></div>
        <textarea id="answer" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ..."></textarea>

        <div class="buttons">
            <button class="read" onclick="playVoice()">ğŸ”Š Ø§Ø³ØªÙ…Ø¹ Ù„Ù„Ø³Ø¤Ø§Ù„</button>
            <button class="voice" onclick="startVoice()">ğŸ¤ Ø¥Ø¬Ø§Ø¨Ø© ØµÙˆØªÙŠØ©</button>
            <button class="next" onclick="nextQuestion()">â¡ï¸ Ø§Ù„ØªØ§Ù„ÙŠ</button>
        </div>
    </div>
</div>

<audio id="voice"></audio>

<script>
/* ================= Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ================= */
const questions = [
 {q:"Ø¹Ø±Ù Ù†ÙØ³Ùƒ ÙÙŠ Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©.", type:"psy"},
 {q:"ÙƒÙŠÙ ØªØªØµØ±Ù ØªØ­Øª Ø¶ØºØ· Ø§Ù„Ø¹Ù…Ù„ØŸ", type:"psy"},
 {q:"Ù…Ø§ Ø£ÙƒØ¨Ø± Ù†Ù‚Ø·Ø© Ø¶Ø¹Ù Ù„Ø¯ÙŠÙƒØŸ", type:"psy"},
 {q:"Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ø±Ø£Ø³Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¥ÙŠØ±Ø§Ø¯ÙŠØŸ", type:"acc"},
 {q:"ÙƒÙŠÙ ØªØ¹Ø§Ù„Ø¬ Ø¹Ø¯Ù… ØªÙˆØ§Ø²Ù† Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŸ", type:"acc"},
 {q:"Ù…Ø§ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¥Ù‡Ù„Ø§Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©ØŸ", type:"acc"},
 {q:"Ù…ØªÙ‰ ÙŠØªÙ… Ø§Ù„Ø§Ø¹ØªØ±Ø§Ù Ø¨Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ØŸ", type:"acc"},
 {q:"Ø¥Ø°Ø§ Ø²Ø§Ø¯Øª Ø§Ù„Ø®ØµÙˆÙ… Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„Ø© Ø¹Ù† Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„Ø©ØŒ Ù…Ø§Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø°Ù„ÙƒØŸ", type:"iq"},
 {q:"ÙƒÙŠÙ ØªØªØ®Ø° Ù‚Ø±Ø§Ø±Ù‹Ø§ ÙÙŠ Ø¸Ù„ Ù†Ù‚Øµ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŸ", type:"iq"}
];

const keywords = {
 acc:["Ø¥ÙŠØ±Ø§Ø¯","Ù…ØµØ±ÙˆÙ","Ø£ØµÙˆÙ„","Ø®ØµÙˆÙ…","Ø¥Ù‡Ù„Ø§Ùƒ","Ù…ÙŠØ²Ø§Ù†ÙŠØ©"],
 psy:["Ø£ØªØ¹Ø§Ù…Ù„","Ø£ØªØ¹Ù„Ù…","Ø£Ø·ÙˆØ±","Ø£Ø®Ø·Ø·","Ø£ØªØ­Ù…Ù„"],
 iq:["ØªØ­Ù„ÙŠÙ„","Ù‚Ø±Ø§Ø±","Ø¨Ø¯Ø§Ø¦Ù„","Ù…Ø®Ø§Ø·Ø±"]
};

let score = {acc:0, psy:0, iq:0};
let index = 0;

const qBox = document.getElementById("question");
const aBox = document.getElementById("answer");
const audio = document.getElementById("voice");

function showQuestion() {
    qBox.textContent = questions[index].q;
    playVoice();
}
showQuestion();

/* ========== ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª + ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø´ÙØ§Ù‡ ========== */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const analyser = audioCtx.createAnalyser();
const source = audioCtx.createMediaElementSource(audio);
source.connect(analyser);
analyser.connect(audioCtx.destination);
analyser.fftSize = 256;
const data = new Uint8Array(analyser.frequencyBinCount);

function playVoice() {
    audio.src = "audio/q" + (index + 1) + ".mp3";
    audio.play();
    audioCtx.resume();
}

function lipSync() {
    analyser.getByteFrequencyData(data);
    let volume = data.reduce((a,b)=>a+b) / data.length;
    if (model) model.scale.y = 1 + volume / 2000;
    requestAnimationFrame(lipSync);
}
audio.onplay = () => lipSync();

/* ========== ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ========== */
function startVoice() {
    if (!('webkitSpeechRecognition' in window)) {
        alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ");
        return;
    }
    const rec = new webkitSpeechRecognition();
    rec.lang = "ar-EG";
    rec.start();
    rec.onresult = e => aBox.value += e.results[0][0].transcript;
}

/* ========== Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ========== */
function evaluate(answer, type) {
    let pts = 0;
    let words = answer.split(" ").length;
    if (words > 5) pts += 2;
    if (words > 15) pts += 2;
    keywords[type].forEach(k => { if (answer.includes(k)) pts++; });
    score[type] += pts;
}

function nextQuestion() {
    evaluate(aBox.value, questions[index].type);
    index++;
    if (index >= questions.length) {
        showResult();
        return;
    }
    aBox.value = "";
    showQuestion();
}

function showResult() {
    qBox.innerHTML = `
    âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¥Ù†ØªØ±ÙÙŠÙˆ<br><br>
    ğŸ§  Ù†ÙØ³ÙŠ: ${score.psy}<br>
    ğŸ“Š Ù…Ø­Ø§Ø³Ø¨Ø©: ${score.acc}<br>
    âš¡ Ø°ÙƒØ§Ø¡: ${score.iq}<br><br>
    â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${finalLevel()}
    `;
}

function finalLevel() {
    let total = score.acc + score.psy + score.iq;
    if (total > 35) return "Ù…Ù…ØªØ§Ø² Ø¬Ø¯Ù‹Ø§";
    if (total > 25) return "Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§";
    if (total > 15) return "Ø¬ÙŠØ¯";
    return "ÙŠØ­ØªØ§Ø¬ ØªØ·ÙˆÙŠØ±";
}

/* ========== Three.js 3D ========== */
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x111111);

let camera = new THREE.PerspectiveCamera(45, window.innerWidth / 380, 0.1, 100);
camera.position.set(0, 1.6, 2.8);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, 380);
document.getElementById("threeScene").appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff, 0.6));
let light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(2,5,5);
scene.add(light);

let model;
let loader = new THREE.GLTFLoader();
loader.load("accountant.glb", gltf => {
    model = gltf.scene;
    model.scale.set(1.4,1.4,1.4);
    model.position.y = -1;
    scene.add(model);
    animate();
});

function animate() {
    requestAnimationFrame(animate);
    if (model) model.rotation.y += 0.001;
    renderer.render(scene, camera);
}
</script>

</body>
</html>
